<div class="relative">
  <button
    class="flex items-center gap-2 bg-slate-200 hover:bg-slate-300 px-4 py-2 rounded w-full"
    (click)="open.set(!open())"
  >
    <div class="relative size-5 shrink-0"><img ngSrc="assets/icon/filters.svg" alt="Create" fill /></div>
  </button>

  <form
    [formGroup]="form"
    class="bg-white absolute shadow min-w-full p-4 right-0 overflow-clip z-20 *:mb-2 md:min-w-64 flex flex-col gap-2"
    [ngClass]="{ hidden: !open() }"
  >
    <!-- Título y Separador -->
    <div>
      <h3 class="font-semibold text-lg text-gray-800">Descargar Reporte</h3>
      <hr class="border-gray-300 mt-2" />
    </div>
    <div class="flex flex-col gap-2">
      <label class="flex items-center gap-2">
        <input type="radio" formControlName="frecuencia" name="frecuencia" value="quincenal" class="size-4" />
        <span>Quincenal</span>
      </label>

      <label class="flex items-center gap-2">
        <input type="radio" formControlName="frecuencia" name="frecuencia" value="mensual" class="size-4" />
        <span>Mensual</span>
      </label>
    </div>

    <!-- Botón de búsqueda -->
    @if (!loading()) {
      <div>
        <button class="w-full px-2 py-1 bg-primary text-white rounded-md mb-1" (click)="submit()">Descargar</button>
      </div>
    } @else {
      <div class="flex justify-center items-center h-full mt-4">
        <div class="loader"></div>
      </div>
    }
  </form>
</div>

<app-modal #descargar>
  <div class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 z-50">
    <div class="bg-white rounded-2xl p-3 w-full max-w-md shadow-xl relative">
      <button
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 focus:outline-none"
        (click)="descargar.close()"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
      <section class="p-4">
        @defer {
          <div class="flex flex-col items-center mb-4">
            <img src="/assets/icon/alert.svg" alt="" class="size-20 mb-4" />
            <h3 class="text-lg font-semibold text-gray-800 text-center">Confirmar descarga de documentos</h3>
          </div>
          <p class="text-sm text-gray-600 mb-4 text-center">
            Estás a punto de descargar
            <span class="font-semibold text-gray-800">{{ countInvoices() || 0 }}</span>
            {{ (countInvoices() || 0) === 1 ? 'documento autorizado' : 'documentos autorizados' }}. Este proceso podría
            tardar unos minutos. ¿Deseas continuar con la descarga?
          </p>

          <div class="flex justify-center gap-4">
            @if (!loading()) {
              <button class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700" (click)="descargarInvoices()">
                Descargar
              </button>
            } @else {
              <div class="flex justify-center items-center h-full mt-4">
                <div class="loader"></div>
              </div>
            }
          </div>
        }
      </section>
    </div>
  </div>
</app-modal>
